<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>catastrophic forgetting and experience replay | An old brother's memo.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">An old brother's memo.</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>catastrophic forgetting and experience replay</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2016-08-21</div><div class="post-categories"><a class="post-category-link" href="/categories/machine-learning/">machine learning</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/reinforcement-learning/">reinforcement learning</a></div></div></div><article><div class="container post"><p>There is a known problem called <strong>catastrophic forgetting</strong> that is a associated with gradient based training methods in online training.</p>
<p>Imagine that in game #1 that our algorithm is training on (learning Q-values for) the player is placed in between the pit and the goal such that the goal is on the right and the pit is on the left. Using <span class="math inline">\(\epsilon\)</span>-greedy stategy, the player takes a random move and by chance takes a step to the right and hits the goal. Great, the algorithm will try to learn that this state-action pair is associated with a high reward by updating its weights in such a way that the output will more closely match the target value (i.e backpropagation). Now, the second game gets initialized and the player is again in between the goal and pit but this time the goal is on the <em>left</em> and the pit is on the <em>right</em>. Perhaps to our naive algorithm, the state seems very similar to the last game. Let’s say the again, the player chooses to make one step to right, but this time it ends up in the pit and gets -10 reward. The player is thinking “what the hell I thought going to the right was the best decision based on my previous experience.” So now it may do backpropagation again to update its state-action value but because this state-action is very similar to the last learned state-action it may mess up its previously learned weights.</p>
<p>This is the essence of catastrophic forgetting. There’s a puch-pull between very similar state-actions (but with divergent targets) that results in this inability to properly learn anything. We generally don’t have this problem in the supervised learning realm because we do randomized batch learning, where we don’t update our weights until we’ve iterated through some random subset of our training data.</p>
<p>Catastrophic forgetting is probably not something we have worry about with the first variant of our game because the targets are always stationary; but with the harder variants, it’s something we should consider, and that is why I’m implementing something called <strong>experience replay</strong>. Experience replay basically gives us minibatch updating in an online learning scheme. It’s actually not a huge deal to implement; here’s how it works.</p>
<ol type="1">
<li>In state <span class="math inline">\(s\)</span>, take action <span class="math inline">\(a\)</span>, observe new state <span class="math inline">\(s_{t+1}\)</span> and reward <span class="math inline">\(r_{t+1}\)</span></li>
<li>Store this as a tuple <span class="math inline">\((s,a,s_{t+1},r_{t+1})\)</span> in a list</li>
<li>Continue to store each experience in this list until we have filled the list to a specific length (up to you to define)</li>
<li>Once the experience replay memory is filled, randomly select a subset (e.g. 40)</li>
<li>Iterate through this subset and calculate value updates for each; store these in a target array (e.g. <code>y_train</code>) and store the state <span class="math inline">\(s\)</span> of each memory in <code>X_train</code></li>
<li>Use <code>X_train</code> and <code>y_train</code> as a minibatch for batch training. For subsequent epochs where the array is full, just overwrite old values in our experience replay memory array</li>
</ol>
</div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:dad@sdz.red" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/sohero" target="_blank"><i class="fa fa-github"></i></a><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cspan id='cnzz_stat_icon_1261298720'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1261298720%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
</script></div><div class="footer">© 2017 <a href="/" rel="nofollow">Hero Memo</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><script>MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>