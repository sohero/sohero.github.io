<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>regular expression | An old brother's memo.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">An old brother's memo.</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>regular expression</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2016-07-14</div><div class="post-categories"><a class="post-category-link" href="/categories/tools/">tools</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/regular-expression/">regular expression</a></div></div></div><article><div class="container post">
<div class="wiz-table-container" style="position: relative; padding: 15px 0px 5px;"><div class="wiz-table-body"><table cellspacing="0" style="margin:auto; border-style:solid; border-width:1px 1px 0px 0px; color:rgb(0,0,0); font-family:Simsun; font-size:16px; background:rgb(238,238,238)"><caption style="margin:auto; font-weight:bold">表1.常用的元字符</caption><thead><tr><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                代码
            </th><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                说明
            </th></tr></thead><tbody><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray" class=""><span class="code" style="margin:3px; color:blue">.</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配除换行符以外的任意字符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\w</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配字母或数字或下划线或汉字</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\s</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配任意的空白符，包括空格，制表符(Tab)，换行符，中文全角空格等</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\d</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配数字</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\b</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配单词的开始或结束</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">^</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配字符串的开始</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">$</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配字符串的结束<br></span></td></tr></tbody></table></div></div><p><br></p><p></p><div class="wiz-table-container" style="position: relative; padding: 15px 0px 5px;"><div class="wiz-table-body"><table cellspacing="0" style="margin:auto; border-style:solid; border-width:1px 1px 0px 0px; color:rgb(0,0,0); font-family:Simsun; font-size:16px; background:rgb(238,238,238)"><caption style="margin:auto; font-weight:bold">表2.常用的限定符</caption><thead><tr><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    代码/语法
                </th><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    说明
                </th></tr></thead><tbody><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">*</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复零次或更多次</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">+</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复一次或更多次</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">?</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复零次或一次</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">{n}</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复n次</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">{n,}</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复n次或更多次</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">{n,m}</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复n到m次<br></span></td></tr></tbody></table></div></div><br><p></p><p></p><div class="wiz-table-container" style="position: relative; padding: 15px 0px 5px;"><div class="wiz-table-body"><table cellspacing="0" style="margin:auto; border-style:solid; border-width:1px 1px 0px 0px; color:rgb(0,0,0); font-family:Simsun; font-size:16px; background:rgb(238,238,238)"><caption style="margin:auto; font-weight:bold">表3.常用的反义代码</caption><thead><tr><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    代码/语法
                </th><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    说明
                </th></tr></thead><tbody><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\W</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配任意不是字母，数字，下划线，汉字的字符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\S</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配任意不是空白符的字符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\D</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配任意非数字的字符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\B</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配不是单词开头或结束的位置</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">[^x]</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配除了x以外的任意字符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">[^aeiou]</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配除了aeiou这几个字母以外的任意字符<br></span></td></tr></tbody></table></div></div><p></p><p><br></p><p></p><div class="wiz-table-container" style="position: relative; padding: 15px 0px 5px;"><div class="wiz-table-body"><table cellspacing="0" style="margin:auto; border-style:solid; border-width:1px 1px 0px 0px; color:rgb(0,0,0); font-family:Simsun; font-size:16px; background:rgb(238,238,238)"><caption style="margin:auto; font-weight:bold">表4.常用分组语法</caption><tbody><tr><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    分类
                </th><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    代码/语法
                </th><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    说明
                </th></tr><tr><th rowspan="3" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    捕获
                </th><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配exp,并捕获文本到自动命名的组里</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?&lt;name&gt;exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配exp,并捕获文本到名称为name的组里，也可以写成(?'name'exp)</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?:exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配exp,不捕获匹配的文本，也不给此分组分配组号</span></td></tr><tr><th rowspan="4" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    零宽断言
                </th><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?=exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配exp前面的位置</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?&lt;=exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配exp后面的位置</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?!exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配后面跟的不是exp的位置</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?&lt;!exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">匹配前面不是exp的位置</span></td></tr><tr><th rowspan="1" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    注释
                </th><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?#comment)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读<br></span></td></tr></tbody></table></div></div><br><div class="wiz-table-container" style="position: relative; padding: 15px 0px 5px;"><div class="wiz-table-body"><table cellspacing="0" style="margin:auto; border-style:solid; border-width:1px 1px 0px 0px; color:rgb(0,0,0); font-family:Simsun; font-size:16px; background:rgb(238,238,238)"><caption style="margin:auto; font-weight:bold">表5.懒惰限定符</caption><thead><tr><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    代码/语法
                </th><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                    说明
                </th></tr></thead><tbody><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">*?</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复任意次，但尽可能少重复</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">+?</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复1次或更多次，但尽可能少重复</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">??</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复0次或1次，但尽可能少重复</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">{n,m}?</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复n到m次，但尽可能少重复</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">{n,}?</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">重复n次以上，但尽可能少重复</span></td></tr></tbody></table></div></div><br><p></p><p></p><h2 id="lookaround" style="border-bottom-style:solid; border-bottom-width:1px; border-bottom-color:gray; border-right-style:solid; border-right-width:1px; border-right-color:gray; clear:both; font-family:Simsun; background-color:rgb(238,238,238)">
    零宽断言
</h2><p></p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px">
    接下来的四个用于查找在某些内容(但并不包括这些内容)之前或之后的东西，也就是说它们像<span class="code" style="margin:3px; color:blue">\b</span>,<span class="code" style="margin:3px; color:blue">^</span>,<span class="code" style="margin:3px; color:blue">$</span>那样用于指定一个位置，这个位置应该满足一定的条件(即断言)，因此它们也被称为<span class="name" style="margin:3px; font-weight:bold">零宽断言</span>。最好还是拿例子来说明吧：
</p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px"><span class="code" style="margin:3px; color:blue">(?=exp)</span>也叫<span class="name" style="margin:3px; font-weight:bold">零宽度正预测先行断言</span>，它<span class="desc" style="margin:3px; text-decoration:underline">断言自身出现的位置的后面能匹配表达式exp</span>。比如<span class="regex" style="margin:3px; color:red">\b\w+(?=ing\b)</span>，匹配<span class="desc" style="margin:3px; text-decoration:underline">以ing结尾的单词的前面部分(除了ing以外的部分)</span>，如查找<span class="string" style="margin:3px; font-style:italic">I'm singing while you're dancing.</span>时，它会匹配<span class="desc" style="margin:3px; text-decoration:underline">sing</span>和<span class="desc" style="margin:3px; text-decoration:underline">danc</span>。
</p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px"><span class="code" style="margin:3px; color:blue">(?&lt;=exp)</span>也叫<span class="name" style="margin:3px; font-weight:bold">零宽度正回顾后发断言</span>，它<span class="desc" style="margin:3px; text-decoration:underline">断言自身出现的位置的前面能匹配表达式exp</span>。比如<span class="regex" style="margin:3px; color:red">(?&lt;=\bre)\w+\b</span>会匹配<span class="desc" style="margin:3px; text-decoration:underline">以re开头的单词的后半部分(除了re以外的部分)</span>，例如在查找<span class="string" style="margin:3px; font-style:italic">reading a book</span>时，它匹配<span class="desc" style="margin:3px; text-decoration:underline">ading</span>。
</p><h2 id="negativelookaround" style="border-bottom-style:solid; border-bottom-width:1px; border-bottom-color:gray; border-right-style:solid; border-right-width:1px; border-right-color:gray; clear:both; font-family:Simsun; background-color:rgb(238,238,238)">
    负向零宽断言
</h2><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px">
    前面我们提到过怎么查找<strong>不是某个字符或不在某个字符类里</strong>的字符的方法(反义)。但是如果我们只是想要<strong>确保某个字符没有出现，但并不想去匹配它</strong>时怎么办？例如，如果我们想查找这样的单词--它里面出现了字母q,但是q后面跟的不是字母u,我们可以尝试这样：
</p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px"><span class="regex" style="margin:3px; color:red">\b\w*q[^u]\w*\b</span>匹配<span class="desc" style="margin:3px; text-decoration:underline">包含<strong>后面不是字母u的字母q</strong>的单词</span>。但是如果多做测试(或者你思维足够敏锐，直接就观察出来了)，你会发现，如果q出现在单词的结尾的话，像<strong>Iraq</strong>,<strong>Benq</strong>，这个表达式就会出错。这是因为<span class="part" style="margin:3px; color:green">[^u]</span>总要匹配一个字符，所以如果q是单词的最后一个字符的话，后面的<span class="part" style="margin:3px; color:green">[^u]</span>将会匹配q后面的单词分隔符(可能是空格，或者是句号或其它的什么)，后面的<span class="part" style="margin:3px; color:green">\w*\b</span>将会匹配下一个单词，于是<span class="regex" style="margin:3px; color:red">\b\w*q[^u]\w*\b</span>就能匹配整个<span class="string" style="margin:3px; font-style:italic">Iraq fighting</span>。<span class="name" style="margin:3px; font-weight:bold">负向零宽断言</span>能解决这样的问题，因为它只匹配一个位置，并不<strong>消费</strong>任何字符。现在，我们可以这样来解决这个问题：<span class="regex" style="margin:3px; color:red">\b\w*q(?!u)\w*\b</span>。
</p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px"><span class="name" style="margin:3px; font-weight:bold">零宽度负预测先行断言</span><span class="code" style="margin:3px; color:blue">(?!exp)</span>，<span class="desc" style="margin:3px; text-decoration:underline">断言此位置的后面不能匹配表达式exp</span>。例如：<span class="regex" style="margin:3px; color:red">\d{3}(?!\d)</span>匹配<span class="desc" style="margin:3px; text-decoration:underline">三位数字，而且这三位数字的后面不能是数字</span>；<span class="regex" style="margin:3px; color:red">\b((?!abc)\w)+\b</span>匹配<span class="desc" style="margin:3px; text-decoration:underline">不包含连续字符串abc的单词</span>。
</p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px">
    同理，我们可以用<span class="code" style="margin:3px; color:blue">(?&lt;!exp)</span>,<span class="name" style="margin:3px; font-weight:bold">零宽度负回顾后发断言</span>来<span class="desc" style="margin:3px; text-decoration:underline">断言此位置的前面不能匹配表达式exp</span>：<span class="regex" style="margin:3px; color:red">(?&lt;![a-z])\d{7}</span>匹配<span class="desc" style="margin:3px; text-decoration:underline">前面不是小写字母的七位数字</span>。
</p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px">
    一个更复杂的例子：<span class="regex" style="margin:3px; color:red">(?&lt;=&lt;(\w+)&gt;).*(?=&lt;\/\1&gt;)</span>匹配<span class="desc" style="margin:3px; text-decoration:underline">不包含属性的简单HTML标签内里的内容</span>。<span class="code" style="margin:3px; color:blue">(?&lt;=&lt;(\w+)&gt;)</span>指定了这样的<span class="name" style="margin:3px; font-weight:bold">前缀</span>：<span class="desc" style="margin:3px; text-decoration:underline">被尖括号括起来的单词</span>(比如可能是&lt;b&gt;)，然后是<span class="part" style="margin:3px; color:green">.*</span>(任意的字符串),最后是一个<span class="name" style="margin:3px; font-weight:bold">后缀</span><span class="part" style="margin:3px; color:green">(?=&lt;\/\1&gt;)</span>。注意后缀里的<span class="part" style="margin:3px; color:green">\/</span>，它用到了前面提过的字符转义；<span class="part" style="margin:3px; color:green">\1</span>则是一个反向引用，引用的正是<span class="desc" style="margin:3px; text-decoration:underline">捕获的第一组</span>，前面的<span class="part" style="margin:3px; color:green">(\w+)</span>匹配的内容，这样如果前缀实际上是&lt;b&gt;的话，后缀就是&lt;/b&gt;了。整个表达式匹配的是&lt;b&gt;和&lt;/b&gt;之间的内容(再次提醒，不包括前缀和后缀本身)。
</p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px"></p><h2 id="balancedgroup" style="border-bottom-style:solid; border-bottom-width:1px; border-bottom-color:gray; border-right-style:solid; border-right-width:1px; border-right-color:gray; clear:both; font-family:Simsun; background-color:rgb(238,238,238)">
    平衡组/递归匹配
</h2><p></p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px">
    有时我们需要匹配像<span class="desc" style="margin:3px; text-decoration:underline">( 100 * ( 50 + 15 ) )这样的可嵌套的层次性结构</span>，这时简单地使用<span class="code" style="margin:3px; color:blue">\(.+\)</span>则只会匹配到最左边的左括号和最右边的右括号之间的内容(这里我们讨论的是贪婪模式，懒惰模式也有下面的问题)。假如原来的字符串里的左括号和右括号出现的次数不相等，比如<span class="string" style="margin:3px; font-style:italic">( 5 / ( 3 + 2 ) ) )</span>，那我们的匹配结果里两者的个数也不会相等。有没有办法在这样的字符串里匹配到最长的，配对的括号之间的内容呢？
</p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px">
    为了避免<span class="code" style="margin:3px; color:blue">(</span>和<span class="code" style="margin:3px; color:blue">\(</span>把你的大脑彻底搞糊涂，我们还是用尖括号代替圆括号吧。现在我们的问题变成了如何把<span class="string" style="margin:3px; font-style:italic">xx &lt;aa &lt;bbb&gt; &lt;bbb&gt; aa&gt; yy</span>这样的字符串里，最长的配对的尖括号内的内容捕获出来？
</p><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px">
    这里需要用到以下的语法构造：
</p><ul style="font-family:Simsun; font-size:16px"><li><span class="code" style="margin:3px; color:blue">(?'group')</span>&nbsp;把捕获的内容命名为group,并压入<span class="name" style="margin:3px; font-weight:bold">堆栈(Stack)</span></li><li><span class="code" style="margin:3px; color:blue">(?'-group')</span>&nbsp;从堆栈上弹出最后压入堆栈的名为group的捕获内容，如果堆栈本来为空，则本分组的匹配失败
    </li><li><span class="code" style="margin:3px; color:blue">(?(group)yes|no)</span>&nbsp;如果堆栈上存在以名为group的捕获内容的话，继续匹配yes部分的表达式，否则继续匹配no部分
    </li><li><span class="code" style="margin:3px; color:blue">(?!)</span>&nbsp;零宽负向先行断言，由于没有后缀表达式，试图匹配总是失败
    </li></ul><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px">
    我们需要做的是每碰到了左括号，就在压入一个"Open",每碰到一个右括号，就弹出一个，到了最后就看看堆栈是否为空－－如果不为空那就证明左括号比右括号多，那匹配就应该失败。正则表达式引擎会进行回溯(放弃最前面或最后面的一些字符)，尽量使整个表达式得到匹配。
</p><pre class="regex" style="color:red">&lt;                         #最外层的左括号
    [^&lt;&gt;]*                #最外层的左括号后面的不是括号的内容
    (
        (
            (?'Open'&lt;)    #碰到了左括号，在黑板上写一个"Open"
            [^&lt;&gt;]*       #匹配左括号后面的不是括号的内容
        )+
        (
            (?'-Open'&gt;)   #碰到了右括号，擦掉一个"Open"
            [^&lt;&gt;]*        #匹配右括号后面不是括号的内容
        )+
    )*
    (?(Open)(?!))         #在遇到最外层的右括号前面，判断黑板上还有没有没擦掉的"Open"；如果还有，则匹配失败

&gt;                         #最外层的右括号</pre><p style="text-indent:2em; line-height:22.4px; margin:5px 20px; font-family:Simsun; font-size:16px">
    平衡组的一个最常见的应用就是匹配HTML,下面这个例子可以匹配<span class="desc" style="margin:3px; text-decoration:underline">嵌套的&lt;div&gt;标签</span>：<span class="regex" style="margin:3px; color:red">&lt;div[^&gt;]*&gt;[^&lt;&gt;]*(((?'Open'&lt;div[^&gt;]*&gt;)[^&lt;&gt;]*)+((?'-Open'&lt;/div&gt;)[^&lt;&gt;]*)+)*(?(Open)(?!))&lt;/div&gt;</span>.
</p><div class="wiz-table-container" style="position: relative; padding: 15px 0px 5px;"><div class="wiz-table-body"><table cellspacing="0" style="margin:auto; border-style:solid; border-width:1px 1px 0px 0px; color:rgb(0,0,0); font-family:Simsun; font-size:16px; background:rgb(238,238,238)"><caption style="margin:auto; font-weight:bold">表7.尚未详细讨论的语法</caption><thead><tr><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                代码/语法
            </th><th scope="col" style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray">
                说明
            </th></tr></thead><tbody><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\a</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">报警字符(打印它的效果是电脑嘀一声)</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\b</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">通常是单词分界位置，但如果在字符类里使用代表退格</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\t</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">制表符，Tab</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\r</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">回车</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\v</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">竖向制表符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\f</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">换页符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\n</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">换行符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\e</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">Escape</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\0nn</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">ASCII代码中八进制代码为nn的字符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\xnn</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">ASCII代码中十六进制代码为nn的字符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\unnnn</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">Unicode代码中十六进制代码为nnnn的字符</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\cN</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">ASCII控制字符。比如\cC代表Ctrl+C</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\A</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">字符串开头(类似^，但不受处理多行选项的影响)</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\Z</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">字符串结尾或行尾(不受处理多行选项的影响)</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\z</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">字符串结尾(类似$，但不受处理多行选项的影响)</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\G</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">当前搜索的开头</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">\p{name}</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">Unicode中命名为name的字符类，例如\p{IsGreek}</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?&gt;exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">贪婪子表达式</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?&lt;x&gt;-&lt;y&gt;exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">平衡组</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?im-nsx:exp)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">在子表达式exp中改变处理选项</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?im-nsx)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">为表达式后面的部分改变处理选项</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?(exp)yes|no)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">把exp当作零宽正向先行断言，如果在这个位置能匹配，使用yes作为此组的表达式；否则使用no</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?(exp)yes)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">同上，只是使用空表达式作为no</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?(name)yes|no)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">如果命名为name的组捕获到了内容，使用yes作为表达式；否则使用no</span></td></tr><tr><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="code" style="margin:3px; color:blue">(?(name)yes)</span></td><td style="border-style:solid; border-width:0px 0px 1px 1px; border-color:gray"><span class="desc" style="margin:3px; text-decoration:underline">同上，只是使用空表达式作为no</span></td></tr></tbody></table></div></div></div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:herosgq@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/sohero" target="_blank"><i class="fa fa-github"></i></a><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cspan id='cnzz_stat_icon_1261298720'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1261298720%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
</script></div><div class="footer">© 2017 <a href="/" rel="nofollow">Hero Memo</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><script>MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>