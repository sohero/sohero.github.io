<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ipython parallel</title>
	
	<meta name="author" content="sohero">
	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/css/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">
	<link rel="shortcut icon" href="favicon.ico">
	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS_HTML"></script>
    
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/sohero">
				<i class="fa fa-github"></i>
			</a>
			
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:herosgq@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
            <input type="text" class="st-default-search-input navbar-toggle" style="width:100px;">
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="/assets/images/bl.png" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/"></a>
    </h3>
</header>


<div id="bio" class="text-center">
	Qiang Brother Notes.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/sohero">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:herosgq@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
        <li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>ipython parallel </h1>
</div>
	
<article>

	<div class="col-sm-12">
	 <span class="post-date">
	 	2015-12-29 
	 </span>
	 <div class="article-outline"></div>
	  <div class="article_body">
	  <p>IPython 3.x. Best using in the ipython environment, or in a py file may raising unpredictable error.</p>
<h2 id="architecture-overview">Architecture overview</h2>
<figure>
<img src="/assets/images/28.png" alt="" />
</figure>
<p>The IPython architecture consists of four components:</p>
<ul>
<li>The IPython engine.</li>
<li>The IPython hub.</li>
<li>The IPython schedulers.</li>
<li>The controller client.</li>
</ul>
<p>These components live in the <code>IPython.parallel</code> package and are installed with IPython.</p>
<h2 id="getting-started">Getting Started</h2>
<p>To use IPython for parallel computing, you need to start one instance of the controller and one or more instances of the engine. Initially, it is best to simply start a controller and engines on a single host using the <code>ipcluster</code> command. To start a controller and 4 engines on your localhost, just do:</p>
<pre><code>ipcluster start -n 4</code></pre>
<p>Once you have started the IPython controller and one or more engines, you are ready to use the engines to do something useful. To make sure everything is working correctly, try the following commands:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">1</span>]: <span class="im">from</span> IPython.parallel <span class="im">import</span> Client

In [<span class="dv">2</span>]: c <span class="op">=</span> Client()

In [<span class="dv">4</span>]: c.ids
Out[<span class="dv">4</span>]: <span class="bu">set</span>([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])

In [<span class="dv">5</span>]: c[:].apply_sync(<span class="kw">lambda</span> : <span class="st">&quot;Hello, World&quot;</span>)
Out[<span class="dv">5</span>]: [ <span class="st">&#39;Hello, World&#39;</span>, <span class="st">&#39;Hello, World&#39;</span>, <span class="st">&#39;Hello, World&#39;</span>, <span class="st">&#39;Hello, World&#39;</span> ]</code></pre></div>
<h2 id="ipython-client-and-views">IPython client and views</h2>
<p>There is one primary object, the <code>Client</code>, for connecting to a cluster. For each execution model, there is a corresponding <code>View</code>. These views allow users to interact with a set of engines through the interface. Here are the two default views:</p>
<ul>
<li>The <code>DirectView</code> class for explicit addressing.</li>
<li>The <code>LoadBalancedView</code> class for destination-agnostic scheduling.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">1</span>]: <span class="im">from</span> IPython.parallel <span class="im">import</span> Client
In [<span class="dv">2</span>]: rc <span class="op">=</span> Client()

<span class="co"># for a visible LAN controller listening on an external port:</span>
In [<span class="dv">2</span>]: rc <span class="op">=</span> Client(<span class="st">&#39;tcp://192.168.1.16:10101&#39;</span>)
<span class="co"># or to connect with a specific profile you have set up:</span>
In [<span class="dv">3</span>]: rc <span class="op">=</span> Client(profile<span class="op">=</span><span class="st">&#39;mpi&#39;</span>)</code></pre></div>
<h2 id="directview">DirectView</h2>
<p>For direct execution, we will make use of a <code>DirectView</code> object, which can be constructed via list-access to the client:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">4</span>]: dview <span class="op">=</span> rc[:] <span class="co"># use all engines</span></code></pre></div>
<h3 id="parallel-map">Parallel map</h3>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">62</span>]: serial_result <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> x:x<span class="op">**</span><span class="dv">10</span>, <span class="bu">range</span>(<span class="dv">32</span>))

In [<span class="dv">63</span>]: parallel_result <span class="op">=</span> dview.map_sync(<span class="kw">lambda</span> x: x<span class="op">**</span><span class="dv">10</span>, <span class="bu">range</span>(<span class="dv">32</span>))

In [<span class="dv">67</span>]: serial_result<span class="op">==</span>parallel_result
Out[<span class="dv">67</span>]: <span class="va">True</span></code></pre></div>
<h3 id="remote-function-decorators">Remote function decorators</h3>
<p>Remote functions are just like normal functions, but when they are called, they execute on one or more engines, rather than locally. IPython provides two decorators:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">10</span>]: @dview.remote(block<span class="op">=</span><span class="va">True</span>)
   ....: <span class="kw">def</span> getpid():
   ....:     <span class="im">import</span> os
   ....:     <span class="cf">return</span> os.getpid()
   ....:

In [<span class="dv">11</span>]: getpid()
Out[<span class="dv">11</span>]: [<span class="dv">12345</span>, <span class="dv">12346</span>, <span class="dv">12347</span>, <span class="dv">12348</span>]</code></pre></div>
<p>The <code>@parallel</code> decorator creates parallel functions, that break up an element-wise operations and distribute them, reconstructing the result.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">12</span>]: <span class="im">import</span> numpy <span class="im">as</span> np

In [<span class="dv">13</span>]: A <span class="op">=</span> np.random.random((<span class="dv">64</span>,<span class="dv">48</span>))

In [<span class="dv">14</span>]: @dview.parallel(block<span class="op">=</span><span class="va">True</span>)
   ....: <span class="kw">def</span> pmul(A,B):
   ....:     <span class="cf">return</span> A<span class="op">*</span>B

In [<span class="dv">15</span>]: C_local <span class="op">=</span> A<span class="op">*</span>A

In [<span class="dv">16</span>]: C_remote <span class="op">=</span> pmul(A,A)

In [<span class="dv">17</span>]: (C_local <span class="op">==</span> C_remote).<span class="bu">all</span>()
Out[<span class="dv">17</span>]: <span class="va">True</span></code></pre></div>
<p>A quick example to illustrate the difference in arguments for the two modes:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">16</span>]: @dview.parallel(block<span class="op">=</span><span class="va">True</span>)
   ....: <span class="kw">def</span> echo(x):
   ....:     <span class="cf">return</span> <span class="bu">str</span>(x)
   ....:

In [<span class="dv">17</span>]: echo(<span class="bu">range</span>(<span class="dv">5</span>))
Out[<span class="dv">17</span>]: [<span class="st">&#39;[0, 1]&#39;</span>, <span class="st">&#39;[2]&#39;</span>, <span class="st">&#39;[3]&#39;</span>, <span class="st">&#39;[4]&#39;</span>]

In [<span class="dv">18</span>]: echo.<span class="bu">map</span>(<span class="bu">range</span>(<span class="dv">5</span>))
Out[<span class="dv">18</span>]: [<span class="st">&#39;0&#39;</span>, <span class="st">&#39;1&#39;</span>, <span class="st">&#39;2&#39;</span>, <span class="st">&#39;3&#39;</span>, <span class="st">&#39;4&#39;</span>]</code></pre></div>
<h3 id="calling-python-functions"><a href="http://ipython.org/ipython-doc/3/parallel/parallel_multiengine.html#calling-python-functions">Calling Python functions</a></h3>
<p>The most basic type of operation that can be performed on the engines is to execute Python code or call Python functions. Executing Python code can be done in blocking or non-blocking mode (non-blocking is default) using the <code>View.execute()</code> method, and calling functions can be done via the <code>View.apply()</code> method.</p>
<h3 id="moving-python-objects-around"><a href="http://ipython.org/ipython-doc/3/parallel/parallel_multiengine.html#moving-python-objects-around">Moving Python objects around</a></h3>
<h3 id="other-things-to-look-at"><a href="http://ipython.org/ipython-doc/3/parallel/parallel_multiengine.html#other-things-to-look-at">Other things to look at</a></h3>
<h4 id="how-to-do-parallel-list-comprehensions">How to do parallel list comprehensions</h4>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">66</span>]: dview.scatter(<span class="st">&#39;x&#39;</span>,<span class="bu">range</span>(<span class="dv">64</span>))

In [<span class="dv">67</span>]: <span class="op">%</span>px y <span class="op">=</span> [i<span class="op">**</span><span class="dv">10</span> <span class="cf">for</span> i <span class="op">in</span> x]
Parallel execution on engines: [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]

In [<span class="dv">68</span>]: y <span class="op">=</span> dview.gather(<span class="st">&#39;y&#39;</span>)

In [<span class="dv">69</span>]: <span class="bu">print</span> y
[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1024</span>, <span class="dv">59049</span>, <span class="dv">1048576</span>, <span class="dv">9765625</span>, <span class="dv">60466176</span>, <span class="dv">282475249</span>, <span class="dv">1073741824</span>,...]</code></pre></div>
<h4 id="remote-imports">Remote imports</h4>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">69</span>]: <span class="cf">with</span> dview.sync_imports():
   ....:     <span class="im">import</span> numpy
importing numpy on engine(s)</code></pre></div>
<blockquote>
<p>sync_imports() does not allow import foo as bar syntax, because the assignment represented by the as bar part is not available to the import hook.</p>
</blockquote>
<h4 id="parallel-exceptions"><a href="http://ipython.org/ipython-doc/3/parallel/parallel_multiengine.html#parallel-exceptions">Parallel exceptions</a></h4>
<h2 id="loadbalancedview">LoadBalancedView</h2>
<p>For load-balanced execution, we will make use of a <code>LoadBalancedView</code> object, which can be constructed via the clientâ€™s <code>load_balanced_view()</code> method:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">4</span>]: lview <span class="op">=</span> rc.load_balanced_view() <span class="co"># default load-balanced view</span></code></pre></div>
<h3 id="parallel-map-1">Parallel map</h3>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">62</span>]: lview.block <span class="op">=</span> <span class="va">True</span>

In [<span class="dv">63</span>]: serial_result <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> x:x<span class="op">**</span><span class="dv">10</span>, <span class="bu">range</span>(<span class="dv">32</span>))

In [<span class="dv">64</span>]: parallel_result <span class="op">=</span> lview.<span class="bu">map</span>(<span class="kw">lambda</span> x:x<span class="op">**</span><span class="dv">10</span>, <span class="bu">range</span>(<span class="dv">32</span>))

In [<span class="dv">65</span>]: serial_result<span class="op">==</span>parallel_result
Out[<span class="dv">65</span>]: <span class="va">True</span></code></pre></div>
<h3 id="parallel-function-decorator">Parallel function decorator</h3>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">10</span>]: @lview.parallel()
   ....: <span class="kw">def</span> f(x):
   ....:     <span class="cf">return</span> <span class="fl">10.0</span><span class="op">*</span>x<span class="op">**</span><span class="dv">4</span>
   ....:

In [<span class="dv">11</span>]: f.<span class="bu">map</span>(<span class="bu">range</span>(<span class="dv">32</span>))    <span class="co"># this is done in parallel</span>
Out[<span class="dv">11</span>]: [<span class="fl">0.0</span>,<span class="fl">10.0</span>,<span class="fl">160.0</span>,...]</code></pre></div>
<h3 id="dependencies">Dependencies</h3>
<h4 id="functional-dependencies">Functional Dependencies</h4>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">9</span>]: <span class="im">from</span> IPython.parallel <span class="im">import</span> depend, require, dependent
In [<span class="dv">10</span>]: @require(<span class="st">&#39;numpy&#39;</span>, <span class="st">&#39;zmq&#39;</span>)
   ....: <span class="kw">def</span> myfunc():
   ....:     <span class="cf">return</span> dostuff()

In [<span class="dv">10</span>]: <span class="kw">def</span> platform_specific(plat):
   ....:    <span class="im">import</span> sys
   ....:    <span class="cf">return</span> sys.platform <span class="op">==</span> plat

In [<span class="dv">11</span>]: @depend(platform_specific, <span class="st">&#39;darwin&#39;</span>)
   ....: <span class="kw">def</span> mactask():
   ....:    do_mac_stuff()

In [<span class="dv">12</span>]: @depend(platform_specific, <span class="st">&#39;nt&#39;</span>)
   ....: <span class="kw">def</span> wintask():
   ....:    do_windows_stuff()</code></pre></div>
<h4 id="graph-dependencies">Graph Dependencies</h4>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">In [<span class="dv">14</span>]: client.block<span class="op">=</span><span class="va">False</span>

In [<span class="dv">15</span>]: ar <span class="op">=</span> lview.<span class="bu">apply</span>(f, args, kwargs)

In [<span class="dv">16</span>]: ar2 <span class="op">=</span> lview.<span class="bu">apply</span>(f2)

In [<span class="dv">17</span>]: <span class="cf">with</span> lview.temp_flags(after<span class="op">=</span>[ar,ar2]):
   ....:    ar3 <span class="op">=</span> lview.<span class="bu">apply</span>(f3)

In [<span class="dv">18</span>]: <span class="cf">with</span> lview.temp_flags(follow<span class="op">=</span>[ar], timeout<span class="op">=</span><span class="fl">2.5</span>)
   ....:    ar4 <span class="op">=</span> lview.<span class="bu">apply</span>(f3)</code></pre></div>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#python-ref">
					python <span>(4)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#python-ref">
					python <span>(4)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#ipython-ref">
					ipython <span>(2)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-12">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=ipython parallel"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/python/2015/12/28/python-note.html" title="python note">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/others/2015/12/30/representation-learning.html" title="Representation Learning">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>




		<footer>
			<hr/>
			<p>
				&copy; 2016 <a href="http://guoqiang.gq">sohero</a>.
                <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1258527085'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1258527085%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
			</p>
		</footer>
	</div>

	<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
	<script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



